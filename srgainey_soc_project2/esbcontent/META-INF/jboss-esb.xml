<?xml version = "1.0" encoding = "UTF-8"?>
<jbossesb xmlns="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.0.1.xsd" parameterReloadSecs="5">

 <providers>        
	<jms-provider name="JMSProvider" connection-factory="ConnectionFactory">
            
 		<jms-bus busid="conciergeGatewayChannel">
			<jms-message-filter dest-type="QUEUE"
				dest-name="queue/concierge_jms_gateway" />
		</jms-bus>

 		<jms-bus busid="conciergeESBChannel">
			<jms-message-filter dest-type="QUEUE"
				dest-name="queue/concierge_esb_channel" />
		</jms-bus>
		
		<jms-bus busid="ExtractRequestEsbChannel" >
			<jms-message-filter dest-type="QUEUE"
				dest-name="queue/concierge_request_extractor"/>
		</jms-bus>

		<jms-bus busid="PrintResultsEsbChannel" >
			<jms-message-filter dest-type="QUEUE"
				dest-name="queue/concierge_result_printer"/>
		</jms-bus>
		    
	</jms-provider>
 </providers>

 <services>
        
	<service name="Starter_Service" category="Concierge_Service"
		description="Use this service to start a process instance">
		<listeners>
			<jms-listener name="JMS-Gateway"
				busidref="conciergeGatewayChannel"
				is-gateway="true" />
			<jms-listener name="ESB-Listener"
				busidref="conciergeESBChannel" />
		</listeners>
		<actions mep="OneWay">
			<!-- THIS CAN BE UNCOMMENTED TO VIEW THE RAW MESSAGE FROM THE JMS QUEUE 
			<action name="print1" class="org.jboss.soa.esb.actions.SystemPrintln">
				<property name="printfull" value="true"/>
			</action>
            -->
            
			<!-- move the body.getContents() into jBPM -->    
			<action name="create_new_process_instance" 
				class="org.jboss.soa.esb.services.jbpm.actions.BpmProcessor">
				<property name="command" value="StartProcessInstanceCommand" />
				<property name="process-definition-name" value="conciergeProcess"/>                                                   
				<property name="esbToBpmVars">
					<mapping esb="BODY_CONTENT" bpm="orginalMessage" />
				</property>             
			</action>
		</actions>
	</service>
        
	<service name="ExtractRequestService" category="Concierge_Service" 
		description="this is a service invoked within the process to extract variables from the xml">
		<listeners>
			<jms-listener name="ESB-Listener" busidref="ExtractRequestEsbChannel"/>
		</listeners>
		<actions>
			<action name="groovy" class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor">
				<property name="script" value="scripts/requestExtractor.groovy" />
			</action>                                
		</actions>
	</service>

	<service name="PrintResultsService" category="Concierge_Service" 
		description="this is a service invoked within the process to print the results of the process">
		<listeners>
			<jms-listener name="ESB-Listener" busidref="PrintResultsEsbChannel"/>
		</listeners>
		<actions>
			<action name="printResults"  class="edu.ncsu.soc.esb.ResultPrinter"/>                              
		</actions>
	</service>

 </services>
 
</jbossesb>